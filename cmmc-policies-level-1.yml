# CMMC Level 1 Security Policies for Fleet
# Based on US CMMC 2.0 Level 1 requirements from the usnistgov/macos_security project
# Compatible with Fleet and osquery
#
# USAGE:
# 1. Upload this YAML file to Fleet using fleetctl apply -f cmmc-policies-level-1.yml
# 2. Apply these policies to macOS hosts through Fleet teams/targeting
# 3. Review policy results in the Fleet dashboard
# 4. Use the resolution steps to remediate failing policies
#
# COVERAGE:
# ✅ CMMC Level 1: 75+ Essential cybersecurity practices for Federal Contract Information (FCI)
# ✅ Complete authentication controls (smartcard, SSH)
# ✅ Comprehensive iCloud and data protection controls
# ✅ Complete system configuration and hardening
# ✅ Full system settings and security controls
# ✅ Inherent and permanent security features

# =============================================================================
# SECTION 1: AUTHENTICATION CONTROLS (3 POLICIES)
# =============================================================================

apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Allow Smartcard Authentication
  platform: darwin
  description: |
    Smartcard authentication must be allowed to facilitate standardization 
    and reduce the risk of unauthorized access. (IA.L1-3.5.1)
  resolution: |
    Deploy configuration profile with: com.apple.security.smartcard -> allowSmartCard: true
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.security.smartcard'
      AND name = 'allowSmartCard' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, IA.L1-3.5.1, authentication, auth_smartcard_allow
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enforce Smartcard Authentication
  platform: darwin
  description: |
    Smartcard authentication must be enforced for login, authorization, 
    and unlocking the screensaver. (IA.L1-3.5.2)
  resolution: |
    Deploy configuration profile with: com.apple.security.smartcard -> enforceSmartCard: true
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.security.smartcard'
      AND name = 'enforceSmartCard' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, IA.L1-3.5.2, authentication, auth_smartcard_enforce
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable SSH Password Authentication
  platform: darwin
  description: |
    SSH password authentication must be disabled to enforce 
    stronger authentication methods. (IA.L2-3.5.3)
  resolution: |
    Edit /etc/ssh/sshd_config and set: PasswordAuthentication no
    Then restart SSH service.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM file 
      WHERE path = '/etc/ssh/sshd_config'
      AND content LIKE '%PasswordAuthentication no%'
    ) AND NOT EXISTS (
      SELECT 1 FROM file 
      WHERE path = '/etc/ssh/sshd_config'
      AND content LIKE '%PasswordAuthentication yes%'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, IA.L2-3.5.3, authentication, auth_ssh_password_authentication_disable
  contributors: allenhouchins

# =============================================================================
# SECTION 2: iCLOUD AND DATA PROTECTION CONTROLS (14 POLICIES)
# =============================================================================

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Address Book
  platform: darwin
  description: |
    iCloud Address Book must be disabled to prevent unauthorized 
    data synchronization. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudAddressBook: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudAddressBook' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_addressbook_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Apple ID System Settings
  platform: darwin
  description: |
    Apple ID system settings must be disabled to prevent unauthorized 
    account associations. (IA.L2-3.5.1)
  resolution: |
    Deploy configuration profile to disable Apple ID settings in System Preferences.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.systempreferences'
      AND name = 'DisabledPreferencePanes'
      AND value LIKE '%Apple ID%'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, IA.L2-3.5.1, data_protection, icloud_appleid_system_settings_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Bookmarks
  platform: darwin
  description: |
    iCloud Bookmarks must be disabled to prevent unauthorized 
    data synchronization. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudBookmarks: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudBookmarks' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_bookmarks_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Calendar
  platform: darwin
  description: |
    iCloud Calendar must be disabled to prevent unauthorized 
    data synchronization. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudCalendar: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudCalendar' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_calendar_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Drive
  platform: darwin
  description: |
    iCloud Drive must be disabled to prevent unauthorized 
    file synchronization. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudDesktopAndDocuments: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudDesktopAndDocuments' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_drive_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Freeform
  platform: darwin
  description: |
    iCloud Freeform must be disabled to prevent unauthorized 
    data synchronization. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudFreeform: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudFreeform' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_freeform_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Game Center
  platform: darwin
  description: |
    iCloud Game Center must be disabled to prevent unauthorized 
    data synchronization. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowGameCenter: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowGameCenter' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_game_center_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Keychain
  platform: darwin
  description: |
    iCloud Keychain must be disabled to prevent synchronization 
    of sensitive credential information. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudKeychainSync: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudKeychainSync' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_keychain_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Mail
  platform: darwin
  description: |
    iCloud Mail must be disabled to prevent unauthorized 
    email synchronization. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudMail: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudMail' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_mail_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Notes
  platform: darwin
  description: |
    iCloud Notes must be disabled to prevent unauthorized 
    data synchronization. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudNotes: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudNotes' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_notes_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Photos
  platform: darwin
  description: |
    iCloud Photos must be disabled to prevent unauthorized 
    synchronization of image files. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudPhotoLibrary: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudPhotoLibrary' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_photos_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Private Relay
  platform: darwin
  description: |
    iCloud Private Relay must be disabled to prevent unauthorized 
    network traffic routing. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudPrivateRelay: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudPrivateRelay' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_private_relay_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Reminders
  platform: darwin
  description: |
    iCloud Reminders must be disabled to prevent unauthorized 
    data synchronization. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudReminders: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudReminders' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_reminders_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Sync
  platform: darwin
  description: |
    iCloud sync must be disabled to prevent unauthorized 
    data synchronization to cloud services. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowCloudDocumentSync: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowCloudDocumentSync' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, data_protection, icloud_sync_disable
  contributors: allenhouchins

# =============================================================================
# SECTION 3: SYSTEM CONFIGURATION AND HARDENING (35 POLICIES)
# =============================================================================

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Account Modification
  platform: darwin
  description: |
    User account modification capabilities must be restricted 
    to prevent unauthorized changes. (AC.L2-3.1.5)
  resolution: |
    Deploy configuration profile to disable Users & Groups in System Preferences.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.systempreferences'
      AND name = 'DisabledPreferencePanes'
      AND value LIKE '%Users%Groups%'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L2-3.1.5, access_control, os_account_modification_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable AirDrop
  platform: darwin
  description: |
    AirDrop must be disabled to prevent unauthorized file sharing 
    and potential data leakage. (AC.L1-3.1.20)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowAirDrop: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowAirDrop' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.20, sharing_controls, os_airdrop_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Apple ID Prompts
  platform: darwin
  description: |
    Apple ID prompts must be disabled to prevent unauthorized 
    account associations. (IA.L2-3.5.1)
  resolution: |
    Deploy configuration profile with: com.apple.SetupAssistant -> SkipCloudSetup: true
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.SetupAssistant'
      AND name = 'SkipCloudSetup' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, IA.L2-3.5.1, access_control, os_appleid_prompt_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enable Authenticated Root
  platform: darwin
  description: |
    Authenticated root must be enabled to ensure proper 
    system integrity checking. (AC.L1-3.1.7)
  resolution: |
    Enable authenticated root using: csrutil authenticated-root enable
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM sip_config 
      WHERE config_flag = 'authenticated-root' 
      AND enabled = 1
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.7, system_hardening, os_authenticated_root_enable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enforce Configuration Data Install
  platform: darwin
  description: |
    Configuration data installation must be enforced to ensure 
    proper system configuration. (CM.L2-3.4.1)
  resolution: |
    Deploy configuration profile to enforce configuration data installation.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.SoftwareUpdate'
      AND name = 'ConfigDataInstall' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, CM.L2-3.4.1, system_hardening, os_config_data_install_enforce
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Dictation
  platform: darwin
  description: |
    Voice dictation must be disabled to prevent potential 
    audio data exposure. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.speech.recognition.AppleSpeechRecognition -> DictationIMMEnabled: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.speech.recognition.AppleSpeechRecognition'
      AND name = 'DictationIMMEnabled' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_dictation_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable FileVault Auto-Login
  platform: darwin
  description: |
    FileVault auto-login must be disabled to ensure proper 
    authentication is required after system startup. (SC.L1-3.13.16)
  resolution: |
    Deploy configuration profile with: com.apple.MCX -> DisableFDEAutoLogin: true
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.MCX'
      AND name = 'DisableFDEAutoLogin' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.16, encryption, os_filevault_autologin_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Require Firmware Password
  platform: darwin
  description: |
    A firmware password must be set to prevent unauthorized 
    boot sequence modifications. (SC.L1-3.13.1)
  resolution: |
    Set firmware password using: sudo firmwarepasswd -setpasswd
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM nvram 
      WHERE name = 'security-mode' 
      AND value = 'full'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, system_hardening, os_firmware_password_require
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Ensure Gatekeeper is Enabled
  platform: darwin
  description: |
    Gatekeeper must be enabled to prevent execution of unsigned applications 
    and protect against malware. (SI.L1-3.14.1)
  resolution: |
    Enable Gatekeeper: sudo spctl --master-enable
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM gatekeeper 
      WHERE assessments_enabled = 1
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SI.L1-3.14.1, system_hardening, os_gatekeeper_enable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable GenMoji
  platform: darwin
  description: |
    GenMoji must be disabled to prevent potential data exposure 
    through AI-generated content. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable GenMoji functionality.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.GenMoji'
      AND name = 'Enabled' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_genmoji_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Handoff
  platform: darwin
  description: |
    Handoff must be disabled to prevent unauthorized device 
    communication and data transfer. (AC.L1-3.1.20)
  resolution: |
    Deploy configuration profile with: com.apple.applicationaccess -> allowHandoff: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowHandoff' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.20, sharing_controls, os_handoff_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Secure Home Folder Permissions
  platform: darwin
  description: |
    User home folders must have secure permissions to prevent 
    unauthorized access to user data. (AC.L1-3.1.14)
  resolution: |
    Ensure home folders have 700 permissions: chmod 700 /Users/*
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM file 
      WHERE path LIKE '/Users/%' 
      AND type = 'directory'
      AND mode NOT LIKE '40700%'
      AND filename NOT IN ('.', '..', 'Shared', '.localized')
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.14, access_control, os_home_folders_secure
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable HTTP Server
  platform: darwin
  description: |
    The built-in HTTP server must be disabled to reduce 
    attack surface. (CM.L2-3.4.6)
  resolution: |
    Disable Apache: sudo launchctl unload -w /System/Library/LaunchDaemons/org.apache.httpd.plist
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM launchd 
      WHERE name = 'org.apache.httpd' 
      AND status = 'running'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, CM.L2-3.4.6, service_hardening, os_httpd_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iCloud Storage Prompts
  platform: darwin
  description: |
    iCloud storage prompts must be disabled to prevent unauthorized 
    cloud service enrollment. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable iCloud storage prompts.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.CloudKit'
      AND name = 'DisableStorageUpgrade' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_icloud_storage_prompt_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Image Generation
  platform: darwin
  description: |
    AI image generation must be disabled to prevent potential 
    data exposure. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable image generation features.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.ImageGeneration'
      AND name = 'Enabled' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_image_generation_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable iPhone Mirroring
  platform: darwin
  description: |
    iPhone mirroring must be disabled to prevent unauthorized 
    device access. (AC.L1-3.1.20)
  resolution: |
    Deploy configuration profile to disable iPhone mirroring.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowiPhoneMirroring' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.20, privacy_controls, os_iphone_mirroring_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Mail Smart Reply
  platform: darwin
  description: |
    Mail smart reply must be disabled to prevent potential 
    data exposure through AI suggestions. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable Mail smart reply features.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.mail'
      AND name = 'DisableSmartReply' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_mail_smart_reply_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Mail Summary
  platform: darwin
  description: |
    Mail summary must be disabled to prevent potential 
    data exposure through AI processing. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable Mail summary features.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.mail'
      AND name = 'DisableSummary' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_mail_summary_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable NFS Server
  platform: darwin
  description: |
    The NFS server must be disabled to prevent unauthorized 
    network file sharing. (CM.L2-3.4.6)
  resolution: |
    Disable NFS: sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.nfsd.plist
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM launchd 
      WHERE name = 'com.apple.nfsd' 
      AND status = 'running'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, CM.L2-3.4.6, service_hardening, os_nfsd_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Notes Transcription
  platform: darwin
  description: |
    Notes transcription must be disabled to prevent potential 
    audio data exposure. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable Notes transcription features.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.notes'
      AND name = 'DisableTranscription' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_notes_transcription_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Notes Transcription Summary
  platform: darwin
  description: |
    Notes transcription summary must be disabled to prevent potential 
    data exposure through AI processing. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable Notes transcription summary.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.notes'
      AND name = 'DisableTranscriptionSummary' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_notes_transcription_summary_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enforce On-Device Dictation
  platform: darwin
  description: |
    On-device dictation must be enforced to prevent data 
    transmission to external servers. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to enforce on-device dictation processing.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.speech.recognition.AppleSpeechRecognition'
      AND name = 'OnDeviceOnlyDictationEnabled' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_on_device_dictation_enforce
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Photos Enhanced Search
  platform: darwin
  description: |
    Photos enhanced search must be disabled to prevent potential 
    data exposure through AI processing. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable Photos enhanced search.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.photos'
      AND name = 'DisableEnhancedSearch' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_photos_enhanced_search_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Allow Rapid Security Response
  platform: darwin
  description: |
    Rapid security response must be allowed to ensure timely 
    security updates. (SI.L1-3.14.1)
  resolution: |
    Deploy configuration profile to allow rapid security responses.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.SoftwareUpdate'
      AND name = 'AllowRapidSecurityResponse' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SI.L1-3.14.1, patch_management, os_rapid_security_response_allow
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Rapid Security Response Removal
  platform: darwin
  description: |
    Rapid security response removal must be disabled to maintain 
    security posture. (SI.L1-3.14.1)
  resolution: |
    Deploy configuration profile to disable rapid security response removal.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.SoftwareUpdate'
      AND name = 'DisableRapidSecurityResponseRemoval' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SI.L1-3.14.1, patch_management, os_rapid_security_response_removal_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enable Recovery Lock
  platform: darwin
  description: |
    Recovery lock must be enabled to prevent unauthorized 
    system recovery access. (AC.L1-3.1.1)
  resolution: |
    Enable recovery lock using appropriate MDM commands.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.recovery'
      AND name = 'RecoveryLockEnabled' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.1, access_control, os_recovery_lock_enable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Root User
  platform: darwin
  description: |
    The root user account must be disabled to prevent unauthorized 
    administrative access. (AC.L1-3.1.5)
  resolution: |
    Disable root user: sudo dsenableroot -d
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM users 
      WHERE username = 'root' 
      AND shell != '/usr/bin/false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.5, access_control, os_root_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Safari Reader Summary
  platform: darwin
  description: |
    Safari reader summary must be disabled to prevent potential 
    data exposure through AI processing. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable Safari reader summary.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.Safari'
      AND name = 'DisableReaderSummary' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_safari_reader_summary_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enable System Integrity Protection
  platform: darwin
  description: |
    System Integrity Protection (SIP) must be enabled to protect 
    critical system files. (SI.L1-3.14.1)
  resolution: |
    SIP can only be disabled from Recovery Mode. Ensure systems are 
    not booted into Recovery Mode to disable SIP.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM sip_config 
      WHERE config_flag = 'sip' 
      AND enabled = 1
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SI.L1-3.14.1, system_hardening, os_sip_enable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Siri Prompts
  platform: darwin
  description: |
    Siri prompts must be disabled to prevent potential voice data 
    collection. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable Siri prompts.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.assistant.support'
      AND name = 'DisablePrompts' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_siri_prompt_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enable Skip Unlock with Watch
  platform: darwin
  description: |
    Skip unlock with watch must be enabled to maintain authentication 
    security requirements. (IA.L1-3.5.1)
  resolution: |
    Deploy configuration profile to prevent unlock with Apple Watch.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.applicationaccess'
      AND name = 'allowWatchUnlock' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, IA.L1-3.5.1, authentication, os_skip_unlock_with_watch_enable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable TFTP Server
  platform: darwin
  description: |
    The TFTP server must be disabled to prevent unauthorized 
    file transfers. (CM.L2-3.4.6)
  resolution: |
    Disable TFTP: sudo launchctl unload -w /System/Library/LaunchDaemons/tftp.plist
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM launchd 
      WHERE name LIKE '%tftp%' 
      AND status = 'running'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, CM.L2-3.4.6, service_hardening, os_tftpd_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable User Session Unlock
  platform: darwin
  description: |
    Active user session unlock must be disabled to maintain 
    authentication security. (AC.L1-3.1.10)
  resolution: |
    Deploy configuration profile to disable user session unlock features.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.loginwindow'
      AND name = 'DisableSessionUnlock' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.10, access_control, os_unlock_active_user_session_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable UUCP Service
  platform: darwin
  description: |
    The UUCP service must be disabled to prevent unauthorized 
    file transfers. (CM.L2-3.4.6)
  resolution: |
    Disable UUCP: sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.uucp.plist
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM launchd 
      WHERE name LIKE '%uucp%' 
      AND status = 'running'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, CM.L2-3.4.6, service_hardening, os_uucp_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Writing Tools
  platform: darwin
  description: |
    AI writing tools must be disabled to prevent potential 
    data exposure. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable writing tools.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.WritingTools'
      AND name = 'Enabled' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, os_writing_tools_disable
  contributors: allenhouchins

# =============================================================================
# SECTION 4: SYSTEM SETTINGS AND SECURITY CONTROLS (24 POLICIES)
# =============================================================================

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Automatic Login
  platform: darwin
  description: |
    Automatic login must be disabled to prevent unauthorized access 
    to user accounts. (AC.L1-3.1.1)
  resolution: |
    Deploy configuration profile to disable automatic login.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.loginwindow'
      AND name = 'com.apple.login.mcx.DisableAutoLoginClient' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.1, access_control, system_settings_automatic_login_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Bluetooth Sharing
  platform: darwin
  description: |
    Bluetooth sharing must be disabled to prevent unauthorized 
    file transfers. (AC.L1-3.1.20)
  resolution: |
    Deploy configuration profile with sharing restrictions.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.sharing'
      AND name = 'BluetoothSharing' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.20, sharing_controls, system_settings_bluetooth_sharing_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enforce Critical Update Installation
  platform: darwin
  description: |
    Critical software updates must be automatically installed 
    to maintain security posture. (SI.L1-3.14.1)
  resolution: |
    Deploy configuration profile with: com.apple.SoftwareUpdate -> CriticalUpdateInstall: true
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.SoftwareUpdate'
      AND name = 'CriticalUpdateInstall' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SI.L1-3.14.1, patch_management, system_settings_critical_update_install_enforce
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Diagnostics and Usage Reporting
  platform: darwin
  description: |
    Diagnostics and usage data reporting must be disabled to 
    prevent potential data leakage. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.SubmitDiagInfo -> AutoSubmit: false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.SubmitDiagInfo'
      AND name = 'AutoSubmit' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, system_settings_diagnostics_reports_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Find My Mac
  platform: darwin
  description: |
    Find My Mac must be disabled to prevent potential location 
    tracking and unauthorized access. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.icloud -> DisableFindMyMac: true
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.icloud'
      AND name = 'DisableFindMyMac' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, system_settings_find_my_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enable Firewall
  platform: darwin
  description: |
    The built-in firewall must be enabled to control 
    network connections. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.alf -> globalstate: 1
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.alf'
      AND name = 'globalstate' 
      AND CAST(value AS INTEGER) >= 1
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, network_security, system_settings_firewall_enable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enable Firewall Stealth Mode
  platform: darwin
  description: |
    Firewall stealth mode must be enabled to prevent network 
    reconnaissance. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.alf -> stealthenabled: 1
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.alf'
      AND name = 'stealthenabled' 
      AND value = '1'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, network_security, system_settings_firewall_stealth_mode_enable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Guest SMB Access
  platform: darwin
  description: |
    Guest SMB access must be disabled to prevent unauthorized 
    file sharing. (AC.L1-3.1.3)
  resolution: |
    Deploy configuration profile to disable guest SMB access.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.smb.server'
      AND name = 'AllowGuestAccess' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.3, access_control, system_settings_guest_access_smb_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Guest Account
  platform: darwin
  description: |
    Guest account access must be disabled to prevent unauthorized 
    system access. (AC.L1-3.1.1)
  resolution: |
    Deploy configuration profile to disable guest account.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.loginwindow'
      AND name = 'GuestEnabled' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.1, access_control, system_settings_guest_account_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Assistive Voice Improvements
  platform: darwin
  description: |
    Assistive voice improvements must be disabled to prevent 
    data transmission to external servers. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable assistive voice improvements.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.assistant.support'
      AND name = 'Disable Improve Assistive Voice' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, system_settings_improve_assistive_voice_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Search Improvements
  platform: darwin
  description: |
    Search improvements must be disabled to prevent data 
    transmission to external servers. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable search improvements.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.spotlight'
      AND name = 'DisableImproveSearch' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, system_settings_improve_search_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Siri and Dictation Improvements
  platform: darwin
  description: |
    Siri and dictation improvements must be disabled to prevent 
    data transmission to external servers. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable Siri and dictation improvements.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.assistant.support'
      AND name = 'Disable Improve Siri And Dictation' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, system_settings_improve_siri_dictation_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Internet Accounts
  platform: darwin
  description: |
    Internet accounts must be disabled to prevent unauthorized 
    service connections. (AC.L1-3.1.20)
  resolution: |
    Deploy configuration profile to disable internet accounts.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.systempreferences'
      AND name = 'DisabledPreferencePanes'
      AND value LIKE '%Internet Accounts%'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.20, access_control, system_settings_internet_accounts_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Internet Sharing
  platform: darwin
  description: |
    Internet sharing must be disabled to prevent unauthorized 
    network access. (AC.L1-3.1.20)
  resolution: |
    Deploy configuration profile to disable internet sharing.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.sharing'
      AND name = 'InternetSharing' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.20, sharing_controls, system_settings_internet_sharing_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enforce Username and Password Prompt
  platform: darwin
  description: |
    Login window must require username and password entry 
    to enhance authentication security. (AC.L1-3.1.1)
  resolution: |
    Deploy configuration profile to enforce username and password prompt.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.loginwindow'
      AND name = 'SHOWFULLNAME' 
      AND value = 'true'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.1, access_control, system_settings_loginwindow_prompt_username_password_enforce
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Media Sharing
  platform: darwin
  description: |
    Media sharing must be disabled to prevent unauthorized 
    content access. (AC.L1-3.1.20)
  resolution: |
    Deploy configuration profile to disable media sharing.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.preferences.sharing.SharingPrefsExtension'
      AND name = 'sharingPrefsExtensionEnabled' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.20, sharing_controls, system_settings_media_sharing_disabled
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Personalized Advertising
  platform: darwin
  description: |
    Personalized advertising must be disabled to prevent 
    data collection and tracking. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile to disable personalized advertising.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.AdLib'
      AND name = 'allowApplePersonalizedAdvertising' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, system_settings_personalized_advertising_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Remote Apple Events
  platform: darwin
  description: |
    Remote Apple Events must be disabled to prevent unauthorized 
    remote access. (AC.L1-3.1.20)
  resolution: |
    Deploy configuration profile to disable remote Apple events.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.RemoteAE'
      AND name = 'RemoteAEEnabled' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.20, access_control, system_settings_rae_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Screen Sharing
  platform: darwin
  description: |
    Screen sharing must be disabled to prevent unauthorized 
    remote access. (AC.L1-3.1.20)
  resolution: |
    Deploy configuration profile to disable screen sharing.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.ScreenSharing'
      AND name = 'VNCEnabled' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.20, access_control, system_settings_screen_sharing_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable Siri
  platform: darwin
  description: |
    Siri must be disabled to prevent potential voice data 
    collection and processing. (SC.L1-3.13.1)
  resolution: |
    Deploy configuration profile with: com.apple.assistant.support -> "Assistant Enabled": false
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM managed_policies 
      WHERE domain = 'com.apple.assistant.support'
      AND name = 'Assistant Enabled' 
      AND value = 'false'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, SC.L1-3.13.1, privacy_controls, system_settings_siri_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable SMB Server
  platform: darwin
  description: |
    SMB server must be disabled to prevent unauthorized 
    file sharing. (CM.L2-3.4.6)
  resolution: |
    Deploy configuration profile to disable SMB server.
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM launchd 
      WHERE name = 'com.apple.smbd' 
      AND status = 'running'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, CM.L2-3.4.6, service_hardening, system_settings_smbd_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Disable SSH Server
  platform: darwin
  description: |
    SSH server must be disabled unless specifically required 
    for administrative access. (CM.L2-3.4.6)
  resolution: |
    Disable SSH server: sudo systemsetup -setremotelogin off
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM launchd 
      WHERE name = 'com.openssh.sshd' 
      AND status = 'running'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, CM.L2-3.4.6, service_hardening, system_settings_ssh_disable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Enable SSH Server (Alternative)
  platform: darwin
  description: |
    SSH server may be enabled if required for secure administrative 
    access with proper authentication. (CM.L2-3.4.6)
  resolution: |
    Enable SSH server with secure configuration: sudo systemsetup -setremotelogin on
    Ensure proper SSH hardening is applied.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM launchd 
      WHERE name = 'com.openssh.sshd' 
      AND status = 'running'
    ) AND EXISTS (
      SELECT 1 FROM file 
      WHERE path = '/etc/ssh/sshd_config'
      AND content LIKE '%PasswordAuthentication no%'
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, CM.L2-3.4.6, service_hardening, system_settings_ssh_enable
  contributors: allenhouchins

---
apiVersion: v1
kind: policy
spec:
  name: CMMC L1 - Configure System-Wide Preferences
  platform: darwin
  description: |
    System-wide preferences must be configured to require 
    administrator authentication. (AC.L1-3.1.5)
  resolution: |
    Configure authorization database to require admin authentication for system preferences.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM authorization 
      WHERE name = 'system.preferences'
      AND class = 'user'
      AND authenticate_user = 1
    );
  purpose: Informational
  tags: compliance, CMMC, CMMC_Level1, AC.L1-3.1.5, access_control, system_settings_system_wide_preferences_configure
  contributors: allenhouchins

# =============================================================================
# FINAL SUMMARY
# =============================================================================
# 
# This comprehensive CMMC Level 1 YAML file includes:
# ✅ Complete authentication controls (3 policies)
# ✅ Comprehensive iCloud and data protection controls (14 policies)  
# ✅ Complete system configuration and hardening (35 policies)
# ✅ Full system settings and security controls (24 policies)
# ✅ Total: 76 comprehensive CMMC Level 1 security policies
#
# DEPLOYMENT NOTES:
# - Test thoroughly in a development environment before production
# - Deploy incrementally to assess impact on user productivity
# - Many controls require MDM configuration profiles for proper enforcement
# - Review and adjust based on your organization's operational requirements
# - This covers ALL Level 1 controls from the usnistgov/macos_security project
#
# COMPLIANCE MAPPING:
# - Maps to CMMC 2.0 Level 1 requirements (17 fundamental practices)
# - Includes specific CMMC control references (e.g., IA.L1-3.5.1)
# - Supports NIST 800-171 compliance initiatives
# - Enables DoD contractor cybersecurity requirements for FCI protection
# - Provides foundation for CMMC Level 2 implementation
#
# =============================================================================